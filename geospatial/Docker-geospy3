#FROM jupyter/scipy-notebook
FROM jupyter/scipy-notebook:ad3574d3c5c7

USER root 

### TauDEM installation adapted from https://github.com/hydroshare/hydroshare-jupyterhub/blob/develop/docker/docker-base/Dockerfile
RUN apt update \
    && apt-get install -y software-properties-common \ 
    && add-apt-repository -y ppa:ubuntugis/ubuntugis-unstable\
    && add-apt-repository -y ppa:ubuntu-toolchain-r/test

RUN apt-get update && apt-get install --fix-missing -y --no-install-recommends \ 
  #gcc-7 \
  #g++-7 \
  #gfortran \
  #autoconf \
  #automake \
  #libtool \
  #libgeos-dev \
  #libproj-dev \   
  #libfuse2 \
  #libfuse-dev \
  build-essential \ 
  git \ 
  subversion \
  #p7zip-full \
  #python \
  #python-dev \
  #python-pip \
  #python-scipy \
  #libxml2-dev \
  #libxslt-dev \
  #libgdal-dev \  
  #python-gdal \
  #gdal-bin \
  #grass \
  #grass-dev \
  #libbsd-dev \
  #vlc  \
  #libx11-dev \
  #man-db \
  wget \
  bash-completion \
  netcat \
  iputils-ping \
  nano \
  openssh-client \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/

#RUN apt-get update && apt-get install --fix-missing -y --no-install-recommends \
#  gdal-bin

USER root

RUN apt-get update && apt-get install --fix-missing -y --no-install-recommends \
  #libgdal-dev \  
  #python-gdal \
  #grass \
  #grass-dev \
  zip


#RUN apt-get update && apt-get install --fix-missing -y --no-install-recommends \
#    zip
    
USER jovyan

### Python3 library
RUN conda install -y -c default\
    pandas \
    gdal \
    basemap \
    geopandas \
    markdown2 \
    #osmnx=0.5.4 \
    osmnx \
    rasterio \
    scikit-image \
 && conda clean --all -y
### End Python3 library 


#{{ Create Dev-Py3 env (Shaohua)
USER jovyan

# conda env
RUN conda install -y -c default holoviews geoviews datashader panel fiona shapely rasterio paramiko ipywidgets pyproj ipython numpy xarray matplotlib geopandas seaborn netCDF4 requests && \
    conda install -y -c conda-forge ipyleaflet jupyterthemes hs_restclient && \
    conda install -y -c conda-forge tqdm statsmodels && \
    conda install -y -c default owslib sqlalchemy cartopy pysal geojson cenpy pykdtree && \
    #geocoder geopy graph-tool elevation pandana
    conda clean --all -y

# Urban simulation
RUN conda install -c udst pandana urbanaccess && \
    conda clean --all -y
#RUN conda install -y -c conda-forge graph-tool postgis qgis && \
#    conda install -c udst pandana urbanaccess && \
#    conda install -c rios pylidar && \
#    conda install -c omgarcia saga-gis && \
#    conda install -c anaconda postgresql && \
#    conda clean --all -y

#RUN pip install --quiet urbanaccess
RUN pip install --quiet urbansim
#RUN pip install --quiet elasticsearch #pymongo spatialite psycopg2 postgres
#RUN pip install python-igraph #networkit graph-tool 
#RUN pip install postgis #grass-session
#RUN pip install plotly
#RUN pip install movingpandas 
#RUN pip install lidar

USER jovyan
#install cybergis
#RUN rm -rf /tmp/cybergis && \
#   git clone -b general https://github.com/cybergis/Jupyter-xsede.git /tmp/cybergis && \
#   cd /tmp/cybergis && \
   #conda install -y setup-tools && \
#   pip install setuptools && \
#   /opt/conda/bin/python3.7 setup.py install && \
#   rm -rf /tmp/cybergis

# kernel
#RUN /opt/conda/envs/dev-py3/bin/python -m ipykernel install \
#    --user \
#    --name "dev-py3" \
#    --display-name "Dev-Python3"
#}} End for Dev-Py3


USER jovyan


RUN conda init
RUN conda config --set auto_activate_base false

ENV GDAL_DATA=/opt/conda/share/gdal
ENV PROJ_LIB=/opt/conda/share/proj
